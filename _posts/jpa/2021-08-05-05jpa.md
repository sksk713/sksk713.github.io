---
layout: post
title: "[자바 ORM 표준 JPA 프로그래밍 - 기본편] 다양한 연관관계 매핑"
author: "SangKyenog Lee"
tags: JPA
---

인프런 강의 < [자바 ORM 표준 JPA 프로그래밍 - 기본편](https://www.inflearn.com/course/ORM-JPA-Basic/dashboard) > 정리

---

## 연관관계 매핑시 고려사항 3가지
1. 다중성
    1. 다대일: `@ManyToOne`
    2. 일대다: `@OneToMany`
    3. 일대일: `@OneToOne`
    4. 다대다: `@ManyToMany`
2. 단방향, 양방향
    - 테이블
        - 외래 키 하나로 양쪽 조인 가능
        - 방향 개념 x
    - 객체
        - 참조용 필드가 있는 쪽으로만 참조 가능
        - 단방향, 양방향(단방향 2개라고 보면 됨) 둘다 존재
3. 연관관계의 주인
    - 테이블을 외래 키 하나로 두개의 테이블이 연관관계가 됨
    - 객체 양방향 관계는 참조를 `2번` 해야됨
        - 따라서 외래 키를 관리할 곳은 지정해야 됨.
        - 연관관계의 주인은 외래 키를 관리하는 곳이 된다.

## 다대일 [N:1] 과 일대다 [1:N]
#### 다대일
![21](/assets/jpaimage/jpa21.png)<br></br>
다대일은 외래 키가 있는 쪽이 연관관계의 주인이며 양쪽을 서로 참조한다.

#### 일대다
- 하나의 팀은 여러 회원을 참조할 수 있다.

![22](/assets/jpaimage/jpa22.png)<br></br>
일대다는 1이 연관관계의 주인이고 다쪽에 외래 키가 있다.<br></br>
`@JoinColumn`을 꼭 사용해야 하고 그렇지 않을 경우 중간에 테이블을 추가해서 조인 테이블 방식 사용한다.<br></br>
`@JoinColumn`에 parameter로 `insertable = false, updatable = flase` 를 넣어야 한다.<br></br>
`단점`으로 엔티티가 관리하는 외래 키가 다른 테이블에 있고, 연관관계 관리를 하기 위해서 `UPDATE SQL`을 실행해야 한다.<br></br>
본인 테이블에 외래 키가 있으면 한번의 INSERT SQL로 끝낼 수 있다.

- **일대다 보다는 다대일 사용하자**

## 일대일
외래 키를 주 테이블 또는 대상 테이블 중에 `선택`이 가능하며, 외래 키에 데이터베이스 유니크 제약조건을 추가한다.

#### 주 테이블에 외래 키
외래 키를 객체 참조와 비슷하게 사용할 수 있어서 객체지향 개발자들에게 선호된다.<br></br>
단점은 값이 없을 때 외래 키에 null이 허용 된다.<br></br>
이 방법은 주 테이블이 외래 키를 가지고 있으므로 주 테이블만 확인해도 대상 테이블과 연관관계가 있는지 알 수 있다.

![23](/assets/jpaimage/jpa23.png)<br></br>
다대일 양방향 매핑 처럼 외래 키가 있는 곳이 연관관계의 주인이며 반대편은 mappedBy 적용해준다.

#### 대상 테이블에 외래 키
전통적인 데이터베이스 개발자들이 선호하며, 이 방법의 장점은 테이블 관계를 일대일에서 일대다로 변경할때, 테이블 구조를 그대로 유지할 수 있다.<br></br>
단점은 프록시 기능의 한계로 지연 로딩으로 설정해도 항상 즉시 로딩이 된다.

![24](/assets/jpaimage/jpa24.png)<br></br>
대상 테이블 외래 키는 단방향 매핑을 지원하지 않는다.

## 다대다
관계형 데이터베이스는 정규화된 테이블 2개로 다대다 관계를 표현할 수 없다.<br></br>연결 테이블을 추가해서 일대다, 다대일로 연결해야 된다.

객체는 컬렉션을 사용해서 양쪽 객체에 리스트를 선언하면 다대다가 가능하지만, 데이터베이스에서는 할 수 없다.

`@ManyToMany`를 사용하고 `@JoinTable`로 연결 테이블을 지정한다.<br></br>
양방향, 단방향 모두 가능!

- **다대다는 그대로 사용하지 말고, 실무에서는 일대다, 다대일로 풀어서 사용하자**